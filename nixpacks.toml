# 가상환경을 명시적으로 생성하고 활성화한 후 pip를 실행합니다.
# Nix 환경에서는 가상환경이 생성되기 전에 python -m pip가 작동하지 않을 수 있습니다.

[phases.setup]
# Python과 sentencepiece 빌드에 필요한 빌드 도구 설치
nixPkgs = ["python3", "gcc", "cmake", "pkg-config"]

[phases.install]
cmds = [
  "python3 -m venv /opt/venv",
  ". /opt/venv/bin/activate && pip install --no-cache-dir --upgrade pip",
  ". /opt/venv/bin/activate && pip install --no-cache-dir -r requirements.txt"
]

[phases.build]
cmds = [
  ". /opt/venv/bin/activate && pip install --no-cache-dir -r requirements.txt"
]

[start]
cmd = "python api_server.py"
